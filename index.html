<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Trash Sorting Game</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        #score-display {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            font-size: 24px;
            font-weight: bold;
            z-index: 1000;
        }

        .ui-container {
            position: fixed;
            bottom: 20px;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 15px;
            z-index: 1000;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 50px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            font-size: 16px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.1s;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-paper {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-organic {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-inorganic {
            background: linear-gradient(135deg, #ee0979 0%, #ff6a00 100%);
        }

        .feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: 900;
            text-shadow: 0 4px 10px rgba(0,0,0,0.8);
            z-index: 2000;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .feedback.show {
            opacity: 1;
            animation: popIn 0.5s ease-out;
        }

        .feedback.correct {
            color: #38ef7d;
        }

        .feedback.wrong {
            color: #ff6a00;
        }

        @keyframes popIn {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .instruction {
            position: fixed;
            top: 80px;
            width: 100%;
            text-align: center;
            color: white;
            font-size: 18px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.8);
            z-index: 1000;
            padding: 10px;
            background: rgba(0,0,0,0.5);
        }
    </style>
</head>
<body>
    <div id="score-display">Score: 0</div>
    
    <div class="instruction" id="instruction">
        Point camera at marker, then select trash type!
    </div>

    <div id="feedback" class="feedback"></div>

    <div class="ui-container">
        <button class="btn btn-paper" onclick="spawnTrash('paper')">ðŸ“„ Paper</button>
        <button class="btn btn-organic" onclick="spawnTrash('organic')">ðŸ¥¬ Organic</button>
        <button class="btn btn-inorganic" onclick="spawnTrash('inorganic')">ðŸ¥¤ Inorganic</button>
    </div>

    <a-scene
        mindar-image="imageTargetSrc: ./assets/targets.mind; autoStart: true; uiLoading: yes; uiScanning: yes;"
        color-space="sRGB"
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">
        
        <a-assets>
            <a-asset-item id="bin-paper" src="./assets/models/bin-kertas.glb"></a-asset-item>
            <a-asset-item id="bin-organic" src="./assets/models/bin-organik.glb"></a-asset-item>
            <a-asset-item id="bin-inorganic" src="./assets/models/bin-anorganik.glb"></a-asset-item>
            <a-asset-item id="trash-paper" src="./assets/models/trash-kertas.glb"></a-asset-item>
            <a-asset-item id="trash-organic" src="./assets/models/trash-organik.glb"></a-asset-item>
            <a-asset-item id="trash-inorganic" src="./assets/models/trash-anorganik.glb"></a-asset-item>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false" cursor="rayOrigin: mouse" raycaster="objects: .clickable">
            <a-entity id="trash-holder" position="0 -0.4 -1.2"></a-entity>
        </a-camera>

        <a-entity light="type: ambient; intensity: 1;"></a-entity>
        <a-entity light="type: directional; intensity: 0.5; castShadow: true;" position="1 1 1"></a-entity>

        <a-entity mindar-image-target="targetIndex: 0">
            <a-plane position="0 0 0" width="2" height="1.5" rotation="-90 0 0" color="#333" opacity="0.4"></a-plane>
            
            <a-entity position="-0.6 0 0" class="bin-container" data-bin-type="paper">
                <a-gltf-model src="#bin-paper" position="0 0 0" scale="0.45 0.45 0.45" class="clickable bin-model"></a-gltf-model>
                <a-text value="PAPER" color="#667eea" align="center" width="1" position="0 0.35 0"></a-text>
            </a-entity>

            <a-entity position="0 0 0" class="bin-container" data-bin-type="organic">
                <a-gltf-model src="#bin-organic" position="0 0 0" scale="0.45 0.45 0.45" class="clickable bin-model"></a-gltf-model>
                <a-text value="ORGANIC" color="#38ef7d" align="center" width="1" position="0 0.35 0"></a-text>
            </a-entity>

            <a-entity position="0.6 0 0" class="bin-container" data-bin-type="inorganic">
                <a-gltf-model src="#bin-inorganic" position="0 0 0" scale="0.45 0.45 0.45" class="clickable bin-model"></a-gltf-model>
                <a-text value="INORGANIC" color="#ff6a00" align="center" width="1" position="0 0.35 0"></a-text>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        let currentScore = 0;
        let currentTrashType = null;

        const scoreEl = document.getElementById('score-display');
        const feedbackEl = document.getElementById('feedback');
        const instructionEl = document.getElementById('instruction');
        const trashHolder = document.getElementById('trash-holder');

        const trashModels = {
            paper: '#trash-paper',
            organic: '#trash-organic',
            inorganic: '#trash-inorganic'
        };

        const scene = document.querySelector('a-scene');

        scene.addEventListener('loaded', () => {
            console.log('Scene loaded!');
            setupBinClickHandlers();
        });

        function setupBinClickHandlers() {
            const binContainers = document.querySelectorAll('.bin-container');
            
            binContainers.forEach(container => {
                const binType = container.getAttribute('data-bin-type');
                const binModel = container.querySelector('.bin-model');
                
                if (binModel) {
                    binModel.addEventListener('click', () => {
                        handleBinClick(binType);
                    });
                    
                    binModel.addEventListener('touchstart', (e) => {
                        e.preventDefault();
                        handleBinClick(binType);
                    });
                }
                
                container.addEventListener('click', () => {
                    handleBinClick(binType);
                });
            });
            
            console.log('Bin handlers setup complete');
        }

        function spawnTrash(type) {
            trashHolder.innerHTML = '';
            currentTrashType = type;
            
            const trashEl = document.createElement('a-entity');
            trashEl.setAttribute('gltf-model', trashModels[type]);
            trashEl.setAttribute('scale', '0.4 0.4 0.4');
            trashEl.setAttribute('rotation', '0 0 0');
            trashEl.setAttribute('animation', {
                property: 'rotation',
                to: '0 360 0',
                loop: true,
                dur: 3000,
                easing: 'linear'
            });
            trashEl.setAttribute('animation__float', {
                property: 'position',
                from: '0 -0.4 -1.2',
                to: '0 -0.35 -1.2',
                dir: 'alternate',
                loop: true,
                dur: 1000,
                easing: 'easeInOutSine'
            });
            
            trashHolder.appendChild(trashEl);
            
            const typeNames = {
                paper: 'Paper',
                organic: 'Organic',
                inorganic: 'Inorganic'
            };
            
            instructionEl.textContent = `${typeNames[type]} selected! Click the correct bin!`;
            console.log('Spawned trash:', type);
        }

        function handleBinClick(binType) {
            console.log('Bin clicked:', binType);
            
            if (!currentTrashType) {
                showFeedback('âš ï¸ Select trash first!', 'wrong');
                return;
            }
            
            throwTrashToBin(binType);
        }

        function throwTrashToBin(binType) {
            const trashEl = trashHolder.firstElementChild;
            if (!trashEl) return;

            trashHolder.innerHTML = '';

            const projectile = document.createElement('a-entity');
            projectile.setAttribute('gltf-model', trashModels[currentTrashType]);
            projectile.setAttribute('scale', '0.4 0.4 0.4');
            
            const camera = document.querySelector('a-camera');
            const cameraPos = camera.getAttribute('position');
            
            projectile.setAttribute('position', `${cameraPos.x} ${cameraPos.y - 0.3} ${cameraPos.z - 1}`);
            
            const targetBin = document.querySelector(`[data-bin-type="${binType}"]`);
            const binPos = targetBin.getAttribute('position');
            
            scene.appendChild(projectile);

            projectile.setAttribute('animation', {
                property: 'position',
                to: `${binPos.x} ${binPos.y + 0.3} ${binPos.z}`,
                dur: 600,
                easing: 'easeInQuad'
            });

            projectile.setAttribute('animation__spin', {
                property: 'rotation',
                to: '360 720 360',
                dur: 600,
                easing: 'linear'
            });

            setTimeout(() => {
                if (projectile.parentNode) {
                    projectile.parentNode.removeChild(projectile);
                }
                
                checkMatch(binType);
            }, 650);
        }

        function checkMatch(binType) {
            if (currentTrashType === binType) {
                currentScore += 10;
                updateScore();
                showFeedback('âœ“ CORRECT! +10', 'correct');
                instructionEl.textContent = 'Great job! Select another trash type!';
            } else {
                currentScore -= 5;
                updateScore();
                showFeedback('âœ— WRONG! -5', 'wrong');
                instructionEl.textContent = 'Try again! Select trash type!';
            }
            
            currentTrashType = null;
        }

        function updateScore() {
            scoreEl.textContent = `Score: ${currentScore}`;
            scoreEl.style.transform = 'scale(1.2)';
            setTimeout(() => {
                scoreEl.style.transform = 'scale(1)';
            }, 200);
        }

        function showFeedback(text, type) {
            feedbackEl.textContent = text;
            feedbackEl.className = `feedback show ${type}`;
            
            setTimeout(() => {
                feedbackEl.className = 'feedback';
            }, 2000);
        }
    </script>
</body>
</html>
